{% extends "base.html" %}
{% load i18n %}

{% block content %}
  <h1 class="my-4">{% trans "Telegram Integration" %}</h1>

  <p class="text-muted">
    {% trans "Link your Telegram account to receive task updates even when you are away from the web application." %}
  </p>

  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">{% trans "Bot token" %}</h5>
      {% if active_token %}
        <p class="card-text">
          <strong>{% trans "Current token" %}:</strong>
          <code>{{ active_token.token }}</code>
        </p>
        <p class="text-muted small">{% trans "Send this token to the Telegram bot to establish a connection. Only the latest generated token is valid." %}</p>
        <form method="post" class="d-inline">
          {% csrf_token %}
          <input type="hidden" name="action" value="generate_token" />
          <button class="btn btn-primary btn-sm" type="submit">{% trans "Generate new token" %}</button>
        </form>
        <form method="post" class="d-inline ms-2">
          {% csrf_token %}
          <input type="hidden" name="action" value="revoke_token" />
          <button class="btn btn-outline-danger btn-sm" type="submit">{% trans "Revoke token" %}</button>
        </form>
      {% else %}
        <p class="text-muted">{% trans "No active token. Generate a new one to connect with the bot." %}</p>
        <form method="post">
          {% csrf_token %}
          <input type="hidden" name="action" value="generate_token" />
          <button class="btn btn-primary" type="submit">{% trans "Generate token" %}</button>
        </form>
      {% endif %}
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <h5 class="card-title">{% trans "Linked Telegram account" %}</h5>
      {% if profile and profile.is_active and profile.chat_id %}
        <p class="card-text">
          <strong>{% trans "Chat ID" %}:</strong> {{ profile.chat_id }}<br />
          {% if profile.username %}
            <strong>{% trans "Username" %}:</strong> @{{ profile.username }}<br />
          {% endif %}
          {% if profile.last_interaction_at %}
            <strong>{% trans "Last interaction" %}:</strong> {{ profile.last_interaction_at|date:'d.m.Y H:i' }} UTC
          {% endif %}
        </p>
        <form method="post">
          {% csrf_token %}
          <input type="hidden" name="action" value="unlink" />
          <button class="btn btn-outline-danger" type="submit">{% trans "Unlink Telegram" %}</button>
        </form>
      {% else %}
        <p class="text-muted">{% trans "Telegram account is not linked yet." %}</p>
      {% endif %}
    </div>
  </div>
{% endblock %}
